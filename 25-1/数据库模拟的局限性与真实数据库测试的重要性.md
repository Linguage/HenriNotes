数据库模拟的局限性与真实数据库测试的重要性
- 原文标题：Database mocks are just not worth it
- 链接：[https://www.shayon.dev/post/2024/365/database-mocks-are-just-not-worth-it/](https://www.shayon.dev/post/2024/365/database-mocks-are-just-not-worth-it/)

- **文章类别**：博客

---
**内容整理**：

### 文章信息
- **作者**：Shayon Mukherjee
- **发布日期**：2024年12月30日
- **阅读时间**：约4分钟

### 正文内容

#### 1. 引言
在开发过程中，使用数据库模拟（mocks）进行测试是很常见的做法，虽然这种方式快速且看似简单，但依赖于真实数据库的测试能够揭示出在应用程序成熟过程中可能出现的隐患。

#### 2. 真实数据库测试的重要性
- **示例对比**：
  - **模拟方法**：使用模拟的用户仓库进行用户创建测试。
  - **真实数据库方法**：直接在真实数据库中创建用户并验证其存在性和状态。

真实数据库的方法能够揭示数据完整性或约束方面的潜在问题，帮助开发者在生产环境中避免调试时间的浪费。

#### 3. 未来-proofing 测试
随着新特性或数据库架构的变化，模拟数据库可能无法捕捉到这些变化带来的错误。使用真实数据库的测试可以及时发现因新验证、数据类型修改或时间戳精度变化引起的问题。

#### 4. 维护真实的数据库状态
在测试账户余额或交易总额时，真实数据库能够暴露出并发、隔离和聚合问题，确保交易处理和聚合计算的准确性。

#### 5. 理解测试中的服务边界
许多应用程序有多个层次（如控制器、服务、仓库等），每一层可以专注于各自的职责。通过在服务层使用真实数据库，而在控制器中模拟服务，可以有效隔离测试关注点。

#### 6. 测试策略与分层职责
- **数据访问层**：真实数据库测试至关重要，确保外键、引用完整性和数据库事务的有效性。
- **服务层**：真实数据库测试揭示业务逻辑如何与数据交互。
- **控制器**：可以模拟服务调用而不影响测试覆盖率。

#### 7. 平衡真实数据库测试与模拟
真实数据库测试对于复杂数据关系和性能敏感的场景尤其重要，而模拟仍然对验证高层次的编排和外部服务交互有价值。

### 主要结论
依赖于真实数据库的测试可以更好地捕捉到潜在问题，确保应用程序的稳定性和可靠性。模拟虽然有其优势，但在许多情况下，真实数据库的测试是不可或缺的。

### 研究亮点
- 强调了真实数据库测试的重要性，尤其是在处理复杂数据关系和业务逻辑时。
- 提供了清晰的示例，展示了模拟与真实数据库测试的不同效果。