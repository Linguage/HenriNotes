真正的测试驱动开发：谷歌的愚人节玩笑

  

**概述**

  

本文以愚人节玩笑的形式，介绍了谷歌“真正的测试驱动开发”（Test Driven Development, TDD）概念。文章宣称谷歌研发出一种新工具，只需编写测试，计算机就能自动生成满足测试的生产代码。虽然内容充满戏谑，但也借此探讨了程序合成、自动化开发等前沿话题，并以幽默方式反映了业界对自动化编程的期待与质疑。

  

**主题梳理**

  

**1. TDD** **的演变与“真正的** **TDD** **”** **概念**

- 传统开发流程通常是先写代码，再为其编写测试用例。TDD（测试驱动开发）则要求开发者先写测试，再写代码以通过测试。
- 谷歌的“真正的TDD”进一步升级：开发者只需编写测试，剩下的由计算机自动完成。文章称这是程序合成（Program Synthesis）领域的最新突破。
- 这种方法的核心在于“只写测试，代码自动生成”，极大地简化了开发流程，理论上可以显著提升生产效率。

  

**2.** **工具演示与实际效果**

- 文章展示了一个实际例子：开发者编写了一个测试用例，工具自动生成了对应的生产代码。
- 测试用例如下（Python伪代码）：class LinkGeneratorTest(googletest.TestCase):

  def setUp(self):

    self.generator = link_generator.LinkGenerator()

  def testGetLinkFromIDs(self):

    expected = ('https://frontend.google.com/advancedSearchResults?'

                's.op=ALL&s.r0.field=ID&s.r0.val=1288585+1310696+1346270+')

    actual = self.generator.GetLinkFromIDs(set((1346270, 1310696, 1288585)))

    self.assertEqual(expected, actual)

  

- 工具自动生成的代码如下：import urllib

class LinkGenerator(object):

  _URL = (

      'https://frontend.google.com/advancedSearchResults?'

      's.op=ALL&s.r0.field=ID&s.r0.val=')

  def GetLinkFromIDs(self, ids):

    result = []

    for id in sorted(ids):

      result.append('%s ' % id)

    return self._URL + urllib.quote_plus(''.join(result))

  

- 工具不仅能生成满足测试的代码，还能抽象输入与输出的关系，避免简单地返回常量字符串。文章戏称工具“越来越像人类程序员”，甚至会在代码里写“我需要喝杯咖啡”这样的注释。

  

**3.** **技术原理与实现方式**

- 工具背后依赖于谷歌大脑（Google Brain），通过学习数十亿行开源代码，掌握代码模式及测试与生产代码的关联。
- 进一步提升准确性的方法包括类型推断（Type Inference）和Girard-Reynolds同构（Girard-Reynolds Isomorphism），分别用于从代码推断类型、从类型推断代码。
- 工具每次保存单元测试时自动运行，通过已学习的模型进行回溯搜索，寻找能满足所有断言的代码片段。
- 为了实现高效响应，系统在Spanner（谷歌分布式数据库）中预存了数百万断言-代码片段对，实现全球低延迟访问。文章称99.5%的请求都能在亚秒级响应。

  

**4.** **使用方式与开放计划**

- 谷歌计划开放免费（有速率限制）服务，允许所有人体验该工具。但由于涉及开源代码的不同许可证（如GPL与BSD），还需解决法律问题。例如，GPL测试不会通过BSD代码片段。
- 有兴趣体验alpha版本的用户可在评论区留言申请。

  

**5.** **社区反馈与愚人节彩蛋**

- 文章下方评论区，许多读者表示“想体验alpha版”，也有人质疑“这是不是愚人节玩笑”。
- 有读者认真讨论自动化代码生成的可能性，甚至引用了Haskell的Djinn工具和相关论文，说明业界对程序合成的关注。
- 也有评论指出，写测试远比设计应用结构和编写代码简单，自动化工具的生产力提升不可能如文中夸张。
- 最终，文章在开头和评论区都明确标注“愚人节玩笑”，提醒读者勿当真。

  

**框架与心智模型**

- **程序合成（** **Program Synthesis** **）心智模型**：通过大量学习已有代码与测试的关联，自动推断出满足测试的生产代码。这一模型强调数据驱动、模式识别和自动化推理，是AI在软件开发领域的典型应用思路。
- **TDD** **流程抽象**：

1. 开发者编写测试用例，明确预期行为与断言。
2. 工具自动分析测试输入与输出，推断出满足断言的代码实现。
3. 通过类型推断与代码模式学习，生成可复用、可扩展的生产代码。
4. 系统持续学习与优化，提升代码生成的智能化水平。

- **自动化开发的局限性思考**：虽然自动化工具能提升效率，但设计应用结构、理解业务逻辑等高阶任务仍需人类参与。自动化的边界与实际生产力提升需理性评估。

  

**基本信息**

- Title: The Real Test Driven Development
- Author: Kaue Silveira
- URL: https://testing.googleblog.com/2014/04/the-real-test-driven-development.html