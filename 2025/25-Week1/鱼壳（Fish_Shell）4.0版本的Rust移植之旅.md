
- 原文标题：Fish 4.0: The Fish Of Theseus 
- 链接：[Fish 4.0: The Fish Of Theseus](https://fishshell.com/blog/rustport/)

- **文章类别**：博客文章 

---
**内容整理**： 

### 文章信息
- **发布日期**：2024年12月28日
- **作者**：@ridiculousfish

### 正文内容

#### 1. 引言
- 文章回顾了鱼壳（Fish Shell）从C++迁移到Rust的过程，强调了这一过程的挑战与成就。

#### 2. 背景
- 鱼壳最初使用C++，但在开发过程中遇到了工具和编译器的差异、人体工程学和线程安全等问题。
- 由于C++的复杂性和安全性问题，团队决定转向Rust。

#### 3. Rust的优势
- Rust的工具和编译器提供了更好的用户体验，错误信息清晰。
- Rust的安装简便，使用`rustup`可以快速上手。
- Rust的设计优先考虑安全性和并发性，适合鱼壳的需求。

#### 4. 平台支持
- Rust支持多种平台，包括macOS、Linux和BSD，确保了鱼壳的广泛兼容性。

#### 5. 移植过程
- 采用“忒修斯之鱼”的策略，逐步将C++组件移植到Rust，确保每个阶段都有可运行的程序。
- 使用`autocxx`生成C++与Rust之间的绑定，简化了移植过程。

#### 6. 时间线
- 关键时间节点包括初始PR的开启与合并、C++代码的删除以及第一个测试版的发布。

#### 7. 遇到的挑战
- Rust在可移植性方面的不足，特别是在低级系统适配时需要手动列举系统。
- 本地化问题，Rust的格式字符串在编译时检查，导致翻译困难。

#### 8. 成就与未来
- 移植工作取得成功，代码库更加简洁，性能有所提升。
- 鱼壳现在能够提供“自安装”包，简化用户体验。
- 未来希望进一步改善构建和安装流程，解决Cygwin平台支持问题。

### 主要结论
- 鱼壳的Rust移植项目是一个成功的案例，展示了团队在面对技术挑战时的坚持与创新。

### 研究亮点
- 移植过程中采用的“忒修斯之鱼”策略有效地保持了程序的可用性。
- Rust的并发特性为鱼壳的多线程执行提供了强有力的支持。
- 通过社区的积极参与，项目得以顺利推进。

--- 

以上是对文章内容的详细整理，确保涵盖了文章的主要信息与结构。
