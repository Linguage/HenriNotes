软件设计原则的四个教训  
  原文标题：4 Software Design Principles I Learned the Hard Way  
  链接：[4 Software Design Principles I Learned the Hard Way](https://read.engineerscodex.com/p/4-software-design-principles-i-learned?utm_source=bonobopress&utm_medium=newsletter&utm_campaign=1800)  

- **文章类别**：博客  

---

### 文章框架
```
├── 引言
│   ├── 作者背景
│   └── 文章目的
├── 第一原则：维护单一数据源
│   ├── 数据同步问题
│   ├── 数据派生与存储
│   └── 实际案例
├── 第二原则：请重复自己（PRY）
│   ├── DRY原则的局限性
│   ├── 代码抽象的弊端
│   └── 适度的代码重复
├── 第三原则：避免过度使用Mock
│   ├── Mock的优缺点
│   ├── 测试的可靠性问题
│   └── 替代方案
├── 第四原则：最小化可变状态
│   ├── 缓存与数据库的权衡
│   ├── 初始版本的开发策略
│   └── 状态管理的重要性
└── 结语
    ├── 订阅信息
    └── 评论与讨论
```

### 文章内容整理

#### 引言
- **作者背景**：作者通过设计和实现一个大型服务项目，总结了四个软件设计原则。这些原则在项目中反复出现，作者认为对其他软件工程师也有参考价值。
- **文章目的**：分享作者在实践中总结的软件设计原则，帮助读者避免类似问题。

#### 第一原则：维护单一数据源
- **数据同步问题**：如果同一数据在多个地方维护，很容易出现同步错误。例如，前端应用中从服务器获取的银行余额，应始终从服务器获取，而不是在本地存储。
- **数据派生与存储**：派生数据（如“可支配余额”）应动态计算，而不是单独存储，以避免同步问题。
- **实际案例**：作者提到，虽然某些情况下派生数据的计算可能成本较高，但大多数情况下，维护单一数据源是更可靠的选择。

#### 第二原则：请重复自己（PRY）
- **DRY原则的局限性**：DRY（Don't Repeat Yourself）原则常被过度应用，导致代码抽象化后变得复杂且难以维护。
- **代码抽象的弊端**：过度抽象会导致代码变得庞大且难以理解，最终失去抽象的初衷。
- **适度的代码重复**：作者建议在某些情况下接受适度的代码重复（PRY），以保持代码的简单性和可维护性。

#### 第三原则：避免过度使用Mock
- **Mock的优缺点**：Mock可以简化单元测试，但可能导致测试与实际生产环境脱节。
- **测试的可靠性问题**：过度依赖Mock可能导致测试无法覆盖实际问题，因为Mock的行为可能与真实环境不一致。
- **替代方案**：作者建议尽量使用真实依赖或本地服务器进行测试，以提高测试的可靠性。

#### 第四原则：最小化可变状态
- **缓存与数据库的权衡**：在优化过程中，过度依赖缓存和数据库可能导致状态管理复杂化。
- **初始版本的开发策略**：在项目初期，尽量减少可变状态，可以避免同步错误和数据冲突。
- **状态管理的重要性**：现代计算机性能足够强大，可以承受一些冗余计算，因此在设计时应优先考虑状态管理的简洁性。

#### 结语
- **订阅信息**：文章最后提供订阅信息，鼓励读者关注更多软件工程相关内容。
- **评论与讨论**：文章引发了读者的讨论，部分读者对某些观点提出了质疑，例如对DRY原则的理解和Mock的使用场景。

### 文章标签
#软件设计原则 ， #代码维护 ， #测试策略 ， #状态管理