# Claude Code 子代理详解与实践

## 概述

本文系统梳理了 Anthropic Claude Code 的“子代理（Subagents）”功能。子代理是为特定任务定制的 AI 助手，能够独立处理分工明确的工作，提升开发效率、上下文管理能力和团队协作一致性。通过子代理，开发者可以为不同场景配置专属的 AI 助理，实现任务自动分流、权限精细控制和最佳实践沉淀。本文将围绕子代理的定义、优势、配置方法、管理方式、使用技巧、最佳实践及进阶用法进行详细展开，帮助读者全面理解并高效应用该功能。

## 子代理的定义与核心机制

- 子代理（Subagents）是 Claude Code 中预先配置的 AI 个体，每个子代理都拥有独立的上下文窗口、专属的系统提示（system prompt）和工具权限。
    
- 每个子代理有明确的任务领域和专业方向。例如：代码审查、调试、数据分析等。
    
- 子代理的上下文与主会话隔离，避免主线程被细节信息干扰，保持高层目标聚焦。
    
- 子代理可以配置允许使用的工具（如 Bash、Grep、Read、Write 等），也可继承主线程全部工具。
    
- Claude Code 会根据任务描述、子代理配置和当前上下文，自动或按需将任务分配给最合适的子代理。开发者也可通过命令显式调用指定子代理。
    

## 子代理的主要优势

- **上下文隔离**：每个子代理拥有独立的上下文，主会话不会被细节信息“污染”，便于聚焦全局目标。
    
- **专业化分工**：子代理可针对特定领域深度定制，提升任务完成的准确率和专业性。例如代码审查子代理专注于代码质量，调试子代理专注于错误定位。
    
- **复用与团队协作**：配置好的子代理可在不同项目间复用，也可共享给团队成员，保证工作流程一致性。
    
- **权限灵活**：可为不同子代理分配不同的工具权限，敏感或高权限工具只授予特定子代理，提升安全性和可控性。
    
- **自动与手动结合**：Claude Code 可根据上下文自动分配子代理，也支持开发者通过命令手动指定，灵活适应多种场景。
    

## 子代理的创建与配置流程

- **快速入门**：
    
    1. 通过 `/agents` 命令打开子代理管理界面。
        
    2. 选择“创建新代理”，可选项目级或用户级子代理。
        
    3. 详细描述子代理的用途、适用场景，并选择允许使用的工具（可留空继承全部工具）。
        
    4. 编辑系统提示（system prompt），明确子代理的角色、能力、工作流程和约束。
        
    5. 保存后，子代理即可被自动或手动调用。
        
- **配置文件结构**：
    
    - 子代理以 Markdown 文件（带 YAML frontmatter）存储，分为项目级（.claude/agents/）和用户级（~/.claude/agents/）。
        
    - 文件示例：
        
        ```
        ---
        name: code-reviewer
        description: 专注于代码质量、安全性和可维护性的代码审查专家。代码编写或修改后立即使用。
        tools: Read, Grep, Glob, Bash
        ---
        你是一名高级代码审查员，确保代码质量和安全性。
        1. 运行 git diff 查看最近更改
        2. 重点关注修改文件
        3. 立即开始审查
        审查清单：
        - 代码简洁可读
        - 函数和变量命名规范
        - 无重复代码
        - 正确的错误处理
        - 无泄露密钥或 API Key
        - 输入校验完善
        - 测试覆盖充分
        - 性能考虑到位
        按优先级反馈问题，并给出具体修复建议。
        ```
        
    - 主要字段说明：
        
        - `name`：唯一标识符（小写字母和连字符）
            
        - `description`：自然语言描述子代理用途
            
        - `tools`：可选，逗号分隔的工具列表，留空则继承全部工具
            
- **工具权限管理**：
    
    - 可通过 `/agents` 命令交互式选择工具，也可手动编辑 `tools` 字段。
        
    - 支持 MCP（Model Context Protocol）工具，若未指定则自动继承主线程所有 MCP 工具。
        

## 子代理的管理与使用方法

- **推荐方式：/agents 命令**
    
    - 通过 `/agents` 命令进入交互式菜单，可查看、创建、编辑、删除子代理，管理工具权限，查看激活状态。
        
    - 支持项目级和用户级子代理，项目级优先级更高。
        
- **直接文件管理**
    
    - 也可直接在对应目录下新建或编辑 Markdown 文件，手动配置子代理。
        
    - 示例命令：
        
        ```
        mkdir -p .claude/agents
        echo '--- ... ---' > .claude/agents/test-runner.md
        ```
        
- **自动与显式调用**
    
    - Claude Code 会根据任务描述和子代理配置自动分配任务。
        
    - 若需强制指定，可在命令中直接点名子代理，例如：
        
        ```
        > 使用 code-reviewer 子代理检查我的最新更改
        > 让 debugger 子代理排查这个错误
        ```
        
- **主动触发建议**
    
    - 在 `description` 字段中加入“主动使用（use proactively）”或“必须使用（MUST BE USED）”等表述，可提升自动分配的积极性。
        

## 框架与心智模型（Framework & Mindset）

- **单一职责原则**：每个子代理只负责一个明确领域，避免“大而全”，提升可预测性和性能。
    
- **详细系统提示**：系统提示应包含具体流程、示例和约束，越详细越能提升子代理表现。
    
- **最小权限原则**：只授予子代理完成任务所需的最小工具权限，提升安全性和聚焦度。
    
- **版本控制与协作**：将项目级子代理纳入版本控制，便于团队协作和持续优化。
    
- **链式调用与动态选择**：可将多个子代理串联，分步完成复杂任务。Claude Code 会根据上下文动态选择最合适的子代理，建议在 `description` 字段中明确适用场景和触发条件。
    

## 进阶用法与性能考量

- **子代理链式调用**：可通过命令串联多个子代理，分阶段处理复杂流程。例如：
    
    ```
    > 先用 code-analyzer 子代理找出性能问题，再用 optimizer 子代理修复
    ```
    
- **动态选择**：Claude Code 会根据上下文和 `description` 字段智能选择子代理，建议描述尽量具体、面向行动。
    
- **性能优化**：
    
    - 子代理上下文独立，有助于主会话保持长时间高效运行。
        
    - 每次调用子代理都会重新加载上下文，可能带来一定延迟，需权衡实时性与上下文隔离的需求。
        

## 基本信息

- Title: Subagents - Anthropic
    
- Author: Anthropic
    
- Date: 未注明（请以官网更新时间为准）
    
- URL: https://docs.anthropic.com/en/docs/claude-code/sub-agents